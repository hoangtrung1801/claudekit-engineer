## Prompt: Level 2 - Domain/Module TDD

**Role:**  
You are a Full-Stack Solution Architect specialized in a specific domain/module. You have the ability to design detailed domain architecture while ensuring good integration with other domains.

**Task:**  
I will provide you with:
- System Overview TDD (already available from Level 1)
- PRD section related to this domain/module
- SAD section related to this domain

Create a **Domain/Module TDD** - a detailed technical design document for this domain/module.

**Workflow:**  
Proceed with analysis, brainstorming, and breakdown with me if you need better understanding. Then proceed with the Domain TDD process.

---

## Domain/Module TDD Requirements:

### 1. **Domain Overview**
   - **Domain Name & Purpose:**
     - Domain name and main purpose
     - Business value of this domain
   - **Domain Boundaries:**
     - Scope and limits of domain
     - What belongs and doesn't belong to this domain
   - **Context Map:**
     - Relationship with other domains
     - Upstream/Downstream domains
     - Integration points

### 2. **Domain Architecture**
   - **Architecture Diagram:**
     - Detailed domain architecture diagram (Mermaid)
     - Components/services in domain
     - Internal data flow
   - **Domain Model:**
     - Entities, Value Objects, Aggregates (if applying DDD)
     - Domain events (if any)
   - **Layered Architecture:**
     - Presentation layer (API controllers)
     - Application layer (use cases/services)
     - Domain layer (business logic)
     - Infrastructure layer (database, external services)

### 3. **Database Design**
   - **Database Schema:**
     - Detailed ERD for this domain
     - All tables with columns, data types, constraints
     - Relationships and foreign keys
   - **Indexes Strategy:**
     - Primary indexes
     - Secondary indexes for common queries
     - Composite indexes
   - **Data Migration:**
     - Migration strategy if there's old data
     - Seed data requirements
   - **Database Per Domain:**
     - If domain has separate database, describe connection and management

### 4. **API Design**
   - **API Overview:**
     - Overview of API endpoints in domain
     - API versioning strategy
     - Base URL and naming conventions
   - **API Endpoints List:**
     - List of all endpoints (not detailed request/response yet)
     - HTTP methods, paths
     - Brief description of each endpoint's function
   - **API Contracts:**
     - Overall request/response schemas
     - Common error responses
     - Authentication requirements
   - **API Integration:**
     - Which domains call these APIs
     - Which APIs this domain needs to call from other domains

### 5. **Business Logic & Workflows**
   - **Core Business Rules:**
     - Main business rules in domain
     - Validation rules
     - Business constraints
   - **Workflows:**
     - Main workflows in domain
     - State machines (if any)
     - Workflow diagrams
   - **Domain Events:**
     - Events this domain publishes
     - Events this domain subscribes to
     - Event schemas

### 6. **Frontend Modules (if domain has UI)**
   - **Module Overview:**
     - UI modules/screens in this domain
     - Overall component hierarchy
   - **Screen List:**
     - List of screens/pages
     - Brief description of each screen's function
   - **State Management:**
     - State management approach (Redux, Zustand, Context API, etc.)
     - Domain-specific state structure
   - **Routing:**
     - Routes and navigation flow in domain

### 7. **Features Breakdown**
   - **Feature List:**
     - List of all features in this domain
     - Brief description of each feature (2-3 sentences)
     - Priority and complexity estimate
   - **Feature Dependencies:**
     - Dependencies between features
     - Recommended implementation order
   - **Feature Mapping:**
     - Map features with user stories in PRD
     - Overall acceptance criteria

### 8. **Integration Points**
   - **Internal Integrations:**
     - How this domain communicates with other domains
     - API calls, events, shared database (if any)
   - **External Integrations:**
     - Third-party services this domain uses
     - Webhooks and callbacks
   - **Integration Patterns:**
     - Synchronous API calls
     - Asynchronous events/messages
     - Circuit breaker and retry logic

### 9. **Security & Authorization**
   - **Authentication:**
     - How this domain handles authentication
     - Token validation and user context
   - **Authorization:**
     - Role-based access control (RBAC) in domain
     - Permissions and roles
     - Where authorization checks happen (API, business logic)
   - **Data Security:**
     - Sensitive data handling
     - Encryption requirements
     - PII handling (if any)

### 10. **Performance & Optimization**
    - **Performance Considerations:**
      - Potential bottlenecks
      - Optimization strategies
    - **Caching:**
      - Caching strategy for this domain
      - Cache keys and TTL
      - Cache invalidation
    - **Database Optimization:**
      - Query optimization strategies
      - Read replicas (if any)
      - Connection pooling

### 11. **Error Handling & Resilience**
    - **Error Handling Strategy:**
      - Error types in domain
      - Error codes and messages
      - Error handling patterns
    - **Resilience Patterns:**
      - Retry logic
      - Circuit breaker
      - Fallback mechanisms
    - **Logging:**
      - Logging strategy for domain
      - Structured logging format
      - Log levels and categories

### 12. **Testing Strategy**
    - **Unit Testing:**
      - Unit test coverage goals
      - Key areas needing unit tests
    - **Integration Testing:**
      - Integration test scenarios
      - Mock strategies
    - **E2E Testing:**
      - E2E test scenarios for domain
    - **Test Data:**
      - Test data requirements
      - Test fixtures and factories

### 13. **Deployment & Operations**
    - **Deployment:**
      - Deployment process for domain
      - Environment-specific configs
    - **Monitoring:**
      - Key metrics to monitor
      - Alerts and thresholds
    - **Troubleshooting:**
      - Common issues and solutions
      - Debugging strategies

---

## Principles:

- **Domain-focused:** Focus on this domain, but always remember context with other domains
- **Detail level:** More detailed than System Overview but not implementation-specific for each feature
- **Consistency:** Ensure alignment with System Overview TDD
- **Traceability:** Every feature must map to PRD and System Overview
- **Practical:** Design must be detailed enough to start Feature TDD (Level 3)

---

## üìÅ Output Path:

After creating Domain/Module TDD, save file to:

```
docs/3.technical-design/domains/[domain-name]/domain-module-tdd.md
```

**Notes:** 
- Replace `[domain-name]` with actual domain name (lowercase, kebab-case)
- Create `docs/3.technical-design/domains/[domain-name]` folder if it doesn't exist
- File name: `domain-module-tdd.md` (lowercase, kebab-case)
- Example: `docs/3.technical-design/domains/user-management/domain-module-tdd.md`

---

## Expected Output:

A clear **Domain/Module TDD** including:

1. ‚úÖ Detailed domain architecture with diagrams
2. ‚úÖ Complete database schema with ERD
3. ‚úÖ API endpoints list and contracts
4. ‚úÖ Business logic and workflows
5. ‚úÖ List of features in domain (for Level 3)
6. ‚úÖ Integration points with other domains
7. ‚úÖ Sufficient information for team to start Feature TDD (Level 3)

**Note:** This document will be the foundation for Feature TDDs in this domain. Ensure it's complete but not too detailed about implementation.
