# Biểu đồ Trực quan hóa Workflow (Visual Workflows)

Tài liệu này giúp bạn hiểu "bên dưới nắp capo" framework sẽ gọi những file nào và các agent nào khi bạn sử dụng các Slash Command.

## 1. Luồng Lập kế hoạch (`/plan`)

Khi bạn gõ lệnh `/plan`, hệ thống kích hoạt quy trình nghiên cứu và thiết kế.

```mermaid
graph TD
    User(["Người dùng gõ /plan"]) --> CmdPlan["file: .claude/commands/plan.md"]
    CmdPlan --> PlannerAgent["Agent: planner.md"]
    
    subgraph ResearchPhase ["Giai đoạn Nghiên cứu"]
        PlannerAgent --> ResAgent1["Agent: researcher.md - Topic 1"]
        PlannerAgent --> ResAgent2["Agent: researcher.md - Topic 2"]
        ResAgent1 & ResAgent2 --> PlannerAgent
    end
    
    PlannerAgent --> OutputPlan[("(File kết quả: ./plans/YYMMDD-plan.md)")]
    OutputPlan --> UserReview(["Người dùng xem xét kế hoạch"])

    style CmdPlan fill:#e1f5fe,stroke:#01579b
    style PlannerAgent fill:#fff3e0,stroke:#e65100
    style OutputPlan fill:#f9f,stroke:#333
```

## 2. Luồng Thực thi Code (`/code`)

Đây là luồng phức tạp nhất, điều phối nhiều agent để biến kế hoạch thành mã nguồn hoàn chỉnh.

```mermaid
graph TD
    User(["Người dùng gõ /code [plan.md]"]) --> CmdCode["file: .claude/commands/code.md"]
    CmdCode --> MainAgent["VAI TRÒ: Main AI Engineer"]
    
    MainAgent --> PM["Agent: project-manager.md - Cập nhật task.md"]
    MainAgent --> Implement["Viết mã nguồn thực tế"]
    
    subgraph QA_Loop ["Vòng lặp Chất lượng"]
        Implement --> Tester["Agent: tester.md - Chạy Unit/Integration Tests"]
        Tester -- Lỗi --> Implement
        Tester -- Pass --> Reviewer["Agent: code-reviewer.md - Soát lỗi bảo mật/style"]
        Reviewer -- Gợi ý --> Implement
    end
    
    Reviewer -- Approved --> Docs["Agent: docs-manager.md - Cập nhật /docs"]
    Docs --> Git["Agent: git-manager.md - Commit & Push"]
    Git --> Done(["Hoàn tất tính năng"])

    style CmdCode fill:#e1f5fe,stroke:#01579b
    style MainAgent fill:#fff3e0,stroke:#e65100
    style QA_Loop fill:#f1f8e9,stroke:#33691e
```

## 3. Luồng Tư vấn Kiến trúc (`/ask`)

Sử dụng khi bạn cần tư vấn thay vì viết code.

```mermaid
graph TD
    User(["Người dùng gõ /ask"]) --> CmdAsk["file: .claude/commands/ask.md"]
    CmdAsk --> Architect["VAI TRÒ: Senior Systems Architect"]
    
    subgraph Specialists ["Các chuyên gia tư vấn"]
        Architect --> SysDes["Systems Designer"]
        Architect --> TechStrat["Technology Strategist"]
        Architect --> ScaleCon["Scalability Consultant"]
        Architect --> RiskAna["Risk Analyst"]
    end
    
    Specialists --> Synthesis["Tổng hợp giải pháp"]
    Synthesis --> Response(["Trả về báo cáo kiến trúc cho Người dùng"])

    style CmdAsk fill:#e1f5fe,stroke:#01579b
    style Architect fill:#ede7f6,stroke:#311b92
```

## 4. Luồng Lên ý tưởng (`/brainstorm`) và Gỡ lỗi (`/debug`)

```mermaid
graph LR
    subgraph Brainstorming
        B_User(["/brainstorm"]) --> B_Cmd["brainstorm.md"]
        B_Cmd --> B_Agent["solution-brainstormer.md"]
        B_Agent --> B_Result(["Báo cáo ý tưởng"])
    end
    
    subgraph Debugging
        D_User(["/debug"]) --> D_Cmd["debug.md"]
        D_Cmd --> D_Agent["debugger.md"]
        D_Agent --> D_Result(["Báo cáo nguyên nhân gốc rễ"])
    end

    style B_Cmd fill:#fffde7,stroke:#fbc02d
    style D_Cmd fill:#fce4ec,stroke:#c2185b
```

---
> [!TIP]
> **Điểm mấu chốt**: Các file trong `.claude/commands/` đóng vai trò là "người điều phối", chúng định nghĩa luật chơi và cách các Agent trong `.opencode/agent/` phải phối hợp với nhau.
